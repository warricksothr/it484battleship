<!DOCTYPE html>
<html>
<head>
    <title>Battleship</title>
    <link href="styles/game.css" rel="stylesheet" type="text/css" id="stylesheet">
    <script type="text/javascript" src="js/util.js" rel="javascript"></script>
    <script>
        //grab the parameters from the URL and alert if we don't have them
        var params = getParamsFromURL();
        if (typeof(params) === 'undefined' 
            || typeof(params.mode) === 'undefined' 
            || typeof(params.players) === 'undefined')
        {
            alert("No parameters or invalid parameters passed in, this could cause problems.");
        }
        
        if (typeof(params.load) !== 'undefined')
        {
            sessionStorage.gameStateSaved = params.load;
        }
    </script>
    <script type="text/javascript" src="js/ai.js" rel="javascript"></script>
    <script type="text/javascript" src="js/engine.js" rel="javascript"></script>
    <script type="text/javascript" src="js/ui.js" rel="javascript"></script>
    <script>
        //script to handle engine persistence
        //check if we are NOT loading a saved state
        if (typeof(sessionStorage.gameStateSaved) !== 'undefined' || sessionStorage.gameStateSaved === 'false')
        {
            var isMode1 = true;
            if (params.mode == 2) { isMode1 = false; }
            //set the player and mode appropriately
            ENGINE.selectGameMode(params.players,isMode1);
        }
    </script>
</head>
<body>
    <script>
        //this is test script to test the interface
        //populate the engine with data only if we have no data to load
        if(sessionStorage.gameStateSaved !== "true")
        {
            //populate the engine with test data
            //set the player mode to 1 and the number of players to 2
            //ENGINE.selectGameMode(2,true);
    
            //get the available ships for the mode
            var ships = ENGINE.getAvailableShips();
            
            //place a ship on the grid randomly
            //check validity of position before placing it
            function placeShipRandomly(ship)
            {
                do
            {
                var rx = getRandomInt(0, 9);
                var ry = getRandomInt(0, 9);
                var rvertical = getRandomInt(0,1);
                var validPlacement = ENGINE.validateShipPlacement(rx,ry,rvertical,ship);
                if (validPlacement)
                {
                    ENGINE.placeShip(rx, ry, rvertical, ship);
                }
            } while(!validPlacement);
            }
            
            // place ships randomly for player 1 //
            placeShipRandomly(ships[0])
            placeShipRandomly(ships[1])
            placeShipRandomly(ships[2])
            placeShipRandomly(ships[3])
            placeShipRandomly(ships[4])
            
            //change to the second player
            ENGINE.changePlayers();
            
            // place ships randomly for player 2 //
            placeShipRandomly(ships[0])
            placeShipRandomly(ships[1])
            placeShipRandomly(ships[2])
            placeShipRandomly(ships[3])
            placeShipRandomly(ships[4])
            
            //change back to player 1
            ENGINE.changePlayers();
        }
        
        //get the available shots to fire
        var shots = ENGINE.getAvailableShots();
        //get the regular shot
        var shot = shots[2];
        ENGINE.selectShot(shot);
        
        //get random coordinates for player 1
        var randomx = getRandomInt(0, 9);
        var randomy = getRandomInt(0, 9);
        
        //fire a random shot
        ENGINE.fireShot(randomx,randomy);
        
        //change to player 2
        ENGINE.changePlayers();
        
        //get the available shots to fire
        var shots = ENGINE.getAvailableShots();
        //get the regular shot
        var shot = shots[2];
        ENGINE.selectShot(shot);
        
        //get random coordinates for player 2
        randomx = getRandomInt(0, 9);
        randomy = getRandomInt(0, 9);
        
        //fire a random shot
        ENGINE.fireShot(randomx,randomy);
        ENGINE.changePlayers();
    </script>
    <!-- this is the list of previous shots -->
    <div id="history">
    <!-- programatically generated  by UI.createHistory("history") -->
    </div>
    <div id="tabletop">
    <!-- this is the tabletop that holds the two boards -->
        <div id="shot" class="board">
        <!-- programatically generated  by UI.createShotGrid("shot") -->
        </div>
        <div id="ship" class="board">
        <!-- programatically generated by UI.createShipGrid("ship") -->
        </div>
    </div>
    <div id="shipview">
    <!-- this is the view of the ships and hits on ships -->
    <!-- programatically generated by UI.createShipViews("shipview") -->
    </div>
    <div id="availableshots">
        <!-- This div should contain the shots available to the player -->
        <!-- Programatically generated -->
    </div>
    <script>
        //call update interface method and pass it the ids of
        UI.updateInterface({historyID:"history", shipID:"ship", shotID:"shot", shipViewID:"shipview"});
    </script>
    <div id="shipgrids" onmouseover="UI.showShipGrid()" onmouseout="UI.hideShipGrid()">
        Ship Views
    </div>
</body>
</html>
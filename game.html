<!DOCTYPE html>
<html>
<head>
    <title id='title'>Battleship</title>
    <link href="styles/game.css" rel="stylesheet" type="text/css" id="stylesheet">
    <script type="text/javascript" src="js/util.js" rel="javascript"></script>
    <script>
        //grab the parameters from the URL and alert if we don't have them
        var params = getParamsFromURL();
        if (typeof(params) === 'undefined' 
            || typeof(params.mode) === 'undefined' 
            || typeof(params.players) === 'undefined')
        {
            
            alert("No parameters or invalid parameters passed in, make sure you access the game from the front page");
            //redirect to the main page
            window.location = "./index.html";
        }
        
        if (typeof(params.load) !== 'undefined')
        {
            sessionStorage.gameStateSaved = params.load;
        }
        //deafult state is not to load from memory
        else
        {
            sessionStorage.gameStateSaved = false;
        }
    </script>
    <script type="text/javascript" src="js/ai.js" rel="javascript"></script>
    <script type="text/javascript" src="js/engine.js" rel="javascript"></script>
    <script type="text/javascript" src="js/ui.js" rel="javascript"></script>
    <script>
        //set the page title
        UI.helperGetElementById('title').textContent = params.name;
        //script to handle engine persistence
        //check if we are NOT loading a saved state
        //saved state is disabled so this will always be the case
        //if (typeof(sessionStorage.gameStateSaved) !== 'undefined' || sessionStorage.gameStateSaved === 'false')
        //{
        //setup the engine with the parameters fro mthe url
        var isMode1 = true;
        if (params.mode == 2) { isMode1 = false; }
        //set the player and mode appropriately
        ENGINE.selectGameMode(params.players,isMode1);
        //set the default shots to regular shots
        ENGINE.player1SelectedShot = regularShot;
        ENGINE.player2SelectedShot = regularShot;
        //}
    </script>
</head>
<body>
    <script>
        //this is the game setup script, either move this into the UI or update it here to handle ship placement for the players
        //get the available ships for the mode
        var ships = ENGINE.getAvailableShips();
        
        //place a ship on the grid randomly
        //check validity of position before placing it
        function placeShipRandomly(ship)
        {
            do
            {
                var validPlacement = false;
                var rx = getRandomInt(0, 9);
                var ry = getRandomInt(0, 9);
                var rvertical = getRandomInt(0,1);
                validPlacement = ENGINE.validateShipPlacement(rx,ry,rvertical,ship);
                if (validPlacement)
                {
                    ENGINE.placeShip(rx, ry, rvertical, ship);
                }
            } while(!validPlacement);
        }
        
        // place ships randomly for player 1 //
        for (var i = 0; i < ships.length; i++)
        {
            placeShipRandomly(ships[i]);
        }
        
        //change to the second player
        ENGINE.changePlayers();
        
        //if the second player is an AI they will do this themselves
        //TODO: remove me later!!!!!!!!
        if (ENGINE.numberOfPlayers !== 1)
        {
            // place ships randomly for player 2 //
            for (var i = 0; i < ships.length; i++)
            {
                placeShipRandomly(ships[i]);
            }
            
            //change back to player 1
            ENGINE.changePlayers();
        }
    </script>
    <!-- this is the list of previous shots -->
    <div id="history">
    <!-- programatically generated  by UI.createHistory("history") -->
    </div>
    <div id="tabletop">
    <!-- this is the tabletop that holds the two boards -->
        <div id="shot" class="board">
        <!-- programatically generated  by UI.createShotGrid("shot") -->
        </div>
        <div id="ship" class="board">
        <!-- programatically generated by UI.createShipGrid("ship") -->
        </div>
    </div>
    <div id="shipview">
    <!-- this is the view of the ships and hits on ships -->
    <!-- programatically generated by UI.createShipViews("shipview") -->
    </div>
    <div id="availableshots">
        <!-- This div should contain the shots available to the player -->
        <!-- Programatically generated by UI.createAvailableShots("availableshots") -->
    </div>
    <script>
        //call update interface method and pass it the ids of
        UI.updateInterface({historyID:"history", shipID:"ship", shotID:"shot", shipViewID:"shipview", availableShotID:"availableshots"});
    </script>
    <div id="shipgrids" onmouseover="UI.showShipGrid()" onmouseout="UI.hideShipGrid()">
        Ship Views
    </div>
</body>
</html>